import{s as te}from"./web-serial-polyfill-CUo6CttV.js";import{d as T,I as he,Q as P,R as W,S as l,U as i,V as s,c as d,W as F,M as ve,O,F as ge,X as be,r as V,u as ye,Y as we,Z as Se,N as ke}from"./@vue-DBfiAxgy.js";import{C as xe}from"./chart.js-BLcQPoJf.js";import{_ as G,a as Ce,b as Pe,c as Be,d as H,u as Ee,e as De,f as Ie,N as Me,g as Ne,h as $e,i as Le,n as Oe}from"./naive-ui-CyyuC-pB.js";import"./@kurkle-BZxJdD1U.js";import"./css-render-Ct37b3-v.js";import"./@emotion-WldOFDRm.js";import"./@css-render-BDgQlOpg.js";import"./seemly-B6YWjrBI.js";import"./lodash-es-HQzkCNu8.js";import"./vooks-DAw0wmzw.js";import"./evtd-CI_DDEu_.js";import"./vueuc-BSZO_Chs.js";import"./vdirs-DL8EOfHr.js";import"./@juggle-C8OzoCMD.js";import"./treemate-BD4Oer00.js";import"./date-fns-B-Rpba9L.js";import"./@babel-Bb34LHWQ.js";import"./date-fns-tz-B6IhecHn.js";import"./async-validator-DKvM95Vc.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const f of a)if(f.type==="childList")for(const v of f.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&r(v)}).observe(document,{childList:!0,subtree:!0});function o(a){const f={};return a.integrity&&(f.integrity=a.integrity),a.referrerPolicy&&(f.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?f.credentials="include":a.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(a){if(a.ep)return;a.ep=!0;const f=o(a);fetch(a.href,f)}})();const oe=1,Re=oe+14;let S={},g=!1,R=!1,U={},x=[];function ne(){S={},g=!1,R=!1,U={},x=[]}async function se(){if(ne(),!Module.serial_wk)return g=!1,!1;if(g)return g;Module.config(20,20,30);for(let t=oe;t<Re;t++){const e=await Module.scsPing(t);e!=-1&&(S[t]=e,g=!0)}return console.log("findDevice",S),g}const Q={Pos:!0,Speed:!0,Load:!0,Current:!0,Voltage:!1,Temper:!1,Move:!1};async function Ae(t){try{for(;x.length>0;){const o=x[0][0],r=x[0][1];await Module[o](...r),x.shift()}}catch(o){for(console.log("setScsData",o);x.length>0;)x.shift()}const e=[];for(const o in t)e.push(parseInt(o));return await Module.scsSyncFeedBack(e,e.length).then(o=>{U=o}),U}const $=Module.setScsData=(t,...e)=>{x.push([t,e])};Module.setSleep=t=>new Promise(e=>{setTimeout(()=>{e("setSleep done")},t)});async function ae(t){if(g){for(R=!1,Module.config(10,20,30);!R;)await Ae(S).then(e=>{t&&t(e)});g=!1}}async function le(){if(g){for(R=!0;g;)await new Promise(t=>{setTimeout(()=>{t("stopScsData done")},1e3)});ne()}}const Te=["id"],ie=T({__name:"AppDemo",setup(t){let e=he({}),o={},r=[];function a(){r=[],o={}}async function f(){a();for(let n in S)S[n]!=-1&&(e["dev_id_"+n]=S[n]);await new Promise(n=>{setTimeout(()=>{n("wait document.getElementById(key) ")},1e3)});for(let n in e)if(e[n]!=-1){const _=document.getElementById(n),c={type:"scatter",data:{datasets:[]},options:{spanGaps:!1,normalized:!0,animation:!1,plugins:{title:{display:!0,text:"设备编号："+n}},responsive:!0,maintainAspectRatio:!1,aspectRatio:1,scales:{x:{display:!1},y:{min:0,max:4095},myScale:{position:"right",min:-2047,max:2047}}}};o[n]=new xe(_,c)}for(let n in Q)Q[n]&&r.push(n);console.log("appflag",r),console.log("appobjs",e),console.log("appdevs",o)}async function v(){for(let n in o)o[n]!=-1&&(o[n].destroy(),o[n]=-1);a()}async function k(n){for(let c in n){const u="dev_id_"+c;let h=o[u].data.datasets;for(let m=0;m<r.length;m++)h[m]||h.push({type:"line",label:r[m],data:[]}),h[m]&&(h[m].data.push(n[c][r[m]]),h[m].data.length>32&&h[m].data.shift());o[u].data.labels.push(new Date().getTime()),o[u].data.labels.length>32&&o[u].data.labels.shift(),o[u].update()}}const b=()=>{g||se().then(()=>{f().then(()=>{ae(k).then(()=>{v(),console.log("runScsData done")})})})},D=()=>{g&&le().then(()=>{console.log("stopScsData done")})};return(n,_)=>{const c=G,u=Ce,h=Pe,m=Be,_e=H;return P(),W(_e,null,{default:l(()=>[i(m,null,{default:l(()=>[i(h,{title:"数据图表"},{default:l(()=>[s("div",null,[i(c,{onClick:b},{default:l(()=>[d(" 开始同步 ")]),_:1}),i(c,{onClick:D},{default:l(()=>[d(" 停止同步 ")]),_:1}),i(u,null,{default:l(()=>[(P(!0),F(ge,null,ve(O(e),(me,K)=>(P(),F("div",{key:K,style:{width:"24%"}},[me!=-1?(P(),F("canvas",{key:0,id:K},null,8,Te)):be("",!0)]))),128))]),_:1})])]),_:1})]),_:1})]),_:1})}}});async function We(){g||se().then(()=>{console.log("findDevice done"),ae(null).then(()=>{console.log("runScsData done")})})}async function Fe(){g&&le().then(()=>{console.log("stopScsData done")})}const Ve=T({setup(){const t=Ee();return{handleClick1(){We(),t.info("Button ScsStart")},handleClick2(){Fe(),t.info("Button ScsStop")},handleClick3(){$("scsWritePosEx",2,5,0,0),t.info("Button scsWritePosEx 2, 5, 0, 0")},handleClick4(){$("scsWritePosEx",2,4090,0,0),t.info("Button scsWritePosEx 2, 4090, 0, 0");for(let e in S)$("scsWritePosEx",e,5,0,0);setTimeout(()=>{for(let e in S)$("scsWritePosEx",e,4095,0,0)},1e3)}}}}),re=(t,e)=>{const o=t.__vccOpts||t;for(const[r,a]of e)o[r]=a;return o};function ze(t,e,o,r,a,f){const v=G,k=H;return P(),W(k,null,{default:l(()=>[i(v,{onClick:t.handleClick1},{default:l(()=>[d(" 启动 ")]),_:1},8,["onClick"]),i(v,{onClick:t.handleClick2},{default:l(()=>[d(" 停止 ")]),_:1},8,["onClick"]),i(v,{onClick:t.handleClick3},{default:l(()=>[d(" 测试 1 ")]),_:1},8,["onClick"]),i(v,{onClick:t.handleClick4},{default:l(()=>[d(" 测试 2 ")]),_:1},8,["onClick"])]),_:1})}const ce=re(Ve,[["render",ze]]),Ue={class:"options"},je=s("div",{class:"info",hidden:""},[s("a",{id:"polyfill_switcher"})],-1),qe=s("select",{id:"ports"},[s("option",{value:"prompt"},"Click 'Connect' to add a port...")],-1),Ye=s("select",{id:"baudrate"},[s("option",{value:"9600"},"9600"),s("option",{value:"14400"},"14400"),s("option",{value:"19200"},"19220"),s("option",{value:"28800"},"28800"),s("option",{value:"38400"},"38400"),s("option",{value:"57600"},"57600"),s("option",{value:"115200"},"115200"),s("option",{value:"230400"},"230400"),s("option",{value:"460800"},"460800"),s("option",{value:"500000",selected:""},"500000"),s("option",{value:"921600"},"921600"),s("option",{value:"custom"},"Custom")],-1),Ge=s("input",{id:"custom_baudrate",type:"number",min:"1",placeholder:"Enter baudrate...",hidden:""},null,-1),He=s("select",{id:"databits"},[s("option",{value:"7"},"7"),s("option",{value:"8",selected:""},"8")],-1),Ke=s("select",{id:"parity"},[s("option",{value:"none",selected:""},"None"),s("option",{value:"even"},"Even"),s("option",{value:"odd"},"Odd")],-1),Qe=s("select",{id:"stopbits"},[s("option",{value:"1",selected:""},"1"),s("option",{value:"2"},"2")],-1),Xe=s("input",{id:"rtscts",type:"checkbox"},null,-1),Ze=s("input",{hidden:"",id:"echo",type:"checkbox"},null,-1),Je=s("input",{hidden:"",id:"enter_flush",type:"checkbox"},null,-1),et=s("input",{hidden:"",id:"convert_eol",type:"checkbox"},null,-1),tt=s("input",{hidden:"",id:"autoconnect",type:"checkbox"},null,-1),ot=s("div",{id:"terminal",hidden:""},null,-1),nt=s("br",null,null,-1),st=s("br",null,null,-1),de=T({__name:"DlsDemo",setup(t){var e;function o(n,_){var c=function(h){return window.alert(arguments.length?h:"")};n.setProperty(_,"alert",n.createNativeFunction(c)),n.setProperty(_,"log",n.createNativeFunction(console.log)),n.setProperty(_,"setScsData",n.createNativeFunction(Module.setScsData))}let r=V(!0),a=V(`setScsData('scsWritePosEx', 2, 4000, 0, 0);

setScsData('scsWritePosEx', 2, 1000, 0, 0);

setScsData('scsWritePosEx', 2, 4000, 0, 0);

setScsData('scsWritePosEx', 2, 3000, 0, 0);

`);const f=()=>{console.log(a.value),e=new Interpreter(a.value,o),r.value=!1},v=()=>{var n=e.getStateStack();if(n.length)var _=n[n.length-1].node,c=_.start,u=_.end;else var c=0,u=0;D(c,u);try{let m=function(){h=e.step(),h&&setTimeout(m,10)};var h=!1;m()}catch(m){console.log(m)}finally{h||(r.value=!0)}},k=()=>{try{e.run()&&setTimeout(k,100)}catch(n){console.log(n)}finally{}},b=V();function D(n,_){if(b.value.createTextRange){var c=b.value.createTextRange();c.collapse(!0),c.moveStart("character",n),c.moveEnd("character",_),c.select()}else b.value.setSelectionRange?b.value.setSelectionRange(n,_):b.value.selectionStart&&(b.value.selectionStart=n,b.value.selectionEnd=_);b.value.focus()}return(n,_)=>{const c=G,u=De,h=H;return P(),W(h,null,{default:l(()=>[s("div",Ue,[i(c,{id:"download",hidden:""},{default:l(()=>[d("Download output")]),_:1}),i(c,{id:"clear",hidden:""},{default:l(()=>[d("Clear output")]),_:1}),je,i(c,{type:"success",round:"",id:"search"},{default:l(()=>[d("Search")]),_:1}),i(c,{type:"primary",tertiary:"",round:"",id:"connect"},{default:l(()=>[d("Connect")]),_:1}),i(u,{size:"small",round:"",for:"ports"},{default:l(()=>[d("Port:")]),_:1}),qe,i(c,{hidden:"",id:"debug1"},{default:l(()=>[d("debug1")]),_:1}),i(c,{hidden:"",id:"debug2"},{default:l(()=>[d("debug2")]),_:1}),i(u,{size:"small",round:"",for:"baudrate"},{default:l(()=>[d("Baud rate:")]),_:1}),Ye,Ge,i(u,{size:"small",round:"",for:"databits"},{default:l(()=>[d("Data bits:")]),_:1}),He,i(u,{size:"small",round:"",for:"parity"},{default:l(()=>[d("Parity:")]),_:1}),Ke,i(u,{size:"small",round:"",for:"stopbits"},{default:l(()=>[d("Stop bits:")]),_:1}),Qe,i(u,{size:"small",round:"",for:"rtscts"},{default:l(()=>[d("Hardware flow control")]),_:1}),Xe,Ze,i(u,{hidden:"",class:"checkbox",for:"echo"},{default:l(()=>[d("Local echo")]),_:1}),Je,i(u,{hidden:"",class:"checkbox",for:"enter_flush"},{default:l(()=>[d("Flush on enter")]),_:1}),et,i(u,{hidden:"",class:"checkbox",for:"convert_eol"},{default:l(()=>[d("Convert EOL")]),_:1}),tt,i(u,{hidden:"",class:"checkbox",for:"autoconnect"},{default:l(()=>[d("Automatically connect")]),_:1}),ot]),s("div",null,[nt,i(c,{onClick:f},{default:l(()=>[d("Parse")]),_:1}),i(c,{onClick:v,disabled:O(r)},{default:l(()=>[d("Step")]),_:1},8,["disabled"]),i(c,{onClick:k,disabled:O(r)},{default:l(()=>[d("Run")]),_:1},8,["disabled"]),st,ye(s("textarea",{ref_key:"code_edit_ref",ref:b,"onUpdate:modelValue":_[0]||(_[0]=m=>Se(a)?a.value=m:a=m),spellcheck:"false",style:{width:"100%",height:"200px"}},`
            `,512),[[we,O(a)]])])]),_:1})}}}),at=T({components:{AppDemo:ie,DlsDemo:de,TestDemo:ce}});function lt(t,e,o,r,a,f){const v=de,k=ce,b=ie,D=Me,n=Ne,_=$e,c=Le,u=Ie;return P(),W(u,null,{default:l(()=>[i(c,null,{default:l(()=>[i(_,null,{default:l(()=>[i(n,null,{default:l(()=>[i(D,null,{default:l(()=>[i(v),i(k),i(b)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const ue=re(at,[["render",lt]]),pe=ke(ue);pe.use(Oe);pe.mount("#app");Module.serial_rx=[];Module.serial_tx=[];Module.serial_wk=!1;console.log("load scslib",Module);console.log("load vue3",ue);let y,C,X,B,E,I,A,M,N,Z=1,p,w;const it=new URLSearchParams(window.location.search),j=it.has("polyfill"),z=8*1024;function fe(t){for(let e=0;e<y.options.length;++e){const o=y.options[e];if(o.value==="prompt")continue;const r=o;if(r.port===t)return r}return null}function q(t){const e=document.createElement("option"),o=t.getInfo();return console.log(o),o.usbProductId!=null&&o.usbVendorId!=null?e.textContent=`Port ${Z++} pid 0x${o.usbProductId.toString(16)} vid 0x${o.usbVendorId.toString(16)}`:e.textContent=`Port ${Z++}`,e.port=t,y.appendChild(e),y.options.length>1&&(y.selectedIndex=y.options.length-1),e}function rt(t){const e=fe(t);return e||q(t)}async function ct(){if(y.value=="prompt"){try{p=await(j?te:navigator.serial).requestPort({})}catch{return}const t=rt(p);t.selected=!0}else p=y.selectedOptions[0].port}function J(){return B.value=="custom"?Number.parseInt(E.value):Number.parseInt(B.value)}function Y(){y.disabled=!1,C.textContent="Connect",C.disabled=!1,B.disabled=!1,E.disabled=!1,I.disabled=!1,A.disabled=!1,M.disabled=!1,N.disabled=!1,p=void 0,Module.serial_wk=!0}async function L(){if(await ct(),!p)return;const t={baudRate:J(),dataBits:Number.parseInt(I.value),parity:A.value,stopBits:Number.parseInt(M.value),flowControl:N.checked?"hardware":"none",bufferSize:z,baudrate:J(),databits:Number.parseInt(I.value),stopbits:Number.parseInt(M.value),rtscts:N.checked};console.log(t),y.disabled=!0,C.textContent="Connecting...",C.disabled=!0,B.disabled=!0,E.disabled=!0,I.disabled=!0,A.disabled=!0,M.disabled=!0,N.disabled=!0;try{await p.open(t),C.textContent="Disconnect",C.disabled=!1,Module.serial_tx_timer&&clearInterval(Module.serial_tx_timer),Module.serial_tx_timer=setInterval(()=>{if(p&&p.writable){const e=p.writable.getWriter();if(Module.serial_tx.length>0){const o=Module.serial_tx.shift();e.write(o)}e.releaseLock()}},1),Module.serial_wk=!0}catch(e){console.error(e),Y();return}for(;p&&p.readable;)try{try{w=p.readable.getReader({mode:"byob"})}catch{w=p.readable.getReader()}let e=null;for(;;){const{value:o,done:r}=await(async()=>{if(w instanceof ReadableStreamBYOBReader){e||(e=new ArrayBuffer(z));const{value:a,done:f}=await w.read(new Uint8Array(e,0,z));return e=a==null?void 0:a.buffer,{value:a,done:f}}else return await w.read()})();if(o&&await new Promise(a=>{Module.serial_rx.push(Array.from(new Uint8Array(o))),a()}),r)break}}catch(e){console.error(e),await new Promise(o=>{e instanceof Error&&console.error("ERROR: "+e.message,o)})}finally{w&&(w.releaseLock(),w=void 0)}if(p){try{await p.close()}catch(e){console.error(e)}Y()}}async function ee(){const t=p;if(p=void 0,w&&await w.cancel(),t)try{await t.close()}catch(e){console.error(e)}Y()}document.addEventListener("DOMContentLoaded",async()=>{y=document.getElementById("ports"),X=document.getElementById("search"),X.addEventListener("click",()=>{p&&ee(),y.selectedIndex=0,L()}),C=document.getElementById("connect"),C.addEventListener("click",()=>{p?ee():L()}),B=document.getElementById("baudrate"),B.addEventListener("input",()=>{B.value=="custom"?E.hidden=!1:E.hidden=!0}),E=document.getElementById("custom_baudrate"),I=document.getElementById("databits"),A=document.getElementById("parity"),M=document.getElementById("stopbits"),N=document.getElementById("rtscts"),(await(j?te:navigator.serial).getPorts()).forEach(o=>q(o)),L(),j||(navigator.serial.addEventListener("connect",o=>{const r=q(o.target);r.selected=!0,L()}),navigator.serial.addEventListener("disconnect",o=>{const r=fe(o.target);r&&r.remove()}))});document.getElementById("debug1").addEventListener("click",()=>{p&&(console.log("debug1"),(async()=>{for(let t=0;t<10;t++)console.log("scsPing",t,await Module.scsPing(t))})())});document.getElementById("debug2").addEventListener("click",()=>{if(p){console.log("debug2");const t=p.writable.getWriter(),e=new Uint8Array(13);e[0]=255,e[1]=255,e[2]=1,e[3]=9,e[4]=3,e[5]=42,e[6]=0,e[7]=0,e[8]=232,e[9]=3,e[10]=0,e[11]=0,e[12]=221,t.write(e),t.releaseLock()}});
